<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Systemd on Underkube</title><link>https://www.underkube.com/pr-preview/pr-47/tags/systemd/</link><description>Recent content in Systemd on Underkube</description><generator>Hugo</generator><language>en-us</language><lastBuildDate>Mon, 21 Feb 2022 08:30:00 +0000</lastBuildDate><atom:link href="https://www.underkube.com/pr-preview/pr-47/tags/systemd/index.xml" rel="self" type="application/rss+xml"/><item><title>Using systemd-path to keep specific folder permissions</title><link>https://www.underkube.com/pr-preview/pr-47/using-systemd-path-to-keep-folder-permissions/</link><pubDate>Mon, 21 Feb 2022 08:30:00 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/using-systemd-path-to-keep-folder-permissions/</guid><description>I wanted to have specific permissions on the /var/lib/libvirt/images folder to be able to write as my user. To do it, you can just use setfacl as:
$ sudo setfacl -m u:edu:rwx /var/lib/libvirt/images The issue is sometimes those permissions were reset to the default ones&amp;hellip; but why? and most important&amp;hellip; who?
auditd ðŸ”—To find the culprit I used auditd to monitor changes in that particular folder as:
$ sudo auditctl -w /var/lib/libvirt/images -p a -k libvirt-images Then, performed a system update just in case&amp;hellip; and after a while&amp;hellip;</description></item><item><title>Nextcloud with podman rootless containers and user systemd services. Part I - Introduction</title><link>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-i-introduction/</link><pubDate>Thu, 28 Jan 2021 08:30:00 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-i-introduction/</guid><description>Introduction ðŸ”—I&amp;rsquo;ve been using Nextcloud for a few years as my personal &amp;lsquo;file storage cloud&amp;rsquo;. There are official container images and docker-compose files to be able to run it easily.
For quite a while, I&amp;rsquo;ve been using the nginx+redis+mariadb+cron docker-compose file as it has all the components to be able to run an &amp;rsquo;enterprise ready&amp;rsquo; Nextcloud, even if I&amp;rsquo;m only using it for personal use :)
In this blog post I&amp;rsquo;m going to try to explain how do I moved from that docker-compose setup to a podman rootless and systemd one.</description></item><item><title>Nextcloud with podman rootless containers and user systemd services. Part II - Nextcloud pod</title><link>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-ii-nextcloud-pod/</link><pubDate>Thu, 28 Jan 2021 08:30:00 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-ii-nextcloud-pod/</guid><description>Running a rootless Nextcloud pod ðŸ”—Instead of running Nextcloud as independant containers, I&amp;rsquo;ve decided to leverage one of the multiple podman features which is being able to run multiple containers as a pod (like a kubernetes pod!)
The main benefit to me of doing so is they they use a single network namespace, meaning all the containers running in the same pod can reach each other using localhost and you only need to expose the web interface.</description></item><item><title>Nextcloud with podman rootless containers and user systemd services. Part III - NFS gotchas</title><link>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-iii-nfs-gotchas/</link><pubDate>Thu, 28 Jan 2021 08:30:00 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-iii-nfs-gotchas/</guid><description>Nextcloud in container user IDs ðŸ”—The nextcloud process running in the container runs as the www-data user which in fact is the user id 82:
$ podman exec -it nextcloud-app /bin/sh /var/www/html # ps auxww | grep php-fpm 1 root 0:10 php-fpm: master process (/usr/local/etc/php-fpm.conf) 74 www-data 0:16 php-fpm: pool www 75 www-data 0:15 php-fpm: pool www 76 www-data 0:07 php-fpm: pool www 84 root 0:00 grep php-fpm /var/www/html # grep www-data /etc/passwd www-data:x:82:82:Linux User,,,:/home/www-data:/sbin/nologin NFS and user IDs ðŸ”—NFS exports can be configured to have a forced uid/gid using the anonuid, anongid and all_squash parameters.</description></item><item><title>Nextcloud with podman rootless containers and user systemd services. Part IV - Exposing Nextcloud externally</title><link>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-iv-exposing/</link><pubDate>Thu, 28 Jan 2021 08:30:00 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-iv-exposing/</guid><description>Introducing bunkerized-nginx ðŸ”—I heard about bunkerized-nginx a while ago and I thought it would be nice to use it as a reverse proxy so I can expose my internal services to the internet &amp;lsquo;safely&amp;rsquo;.
A non-exhaustive list of features (copy &amp;amp; paste from the README):
HTTPS support with transparent Let&amp;rsquo;s Encrypt automation State-of-the-art web security : HTTP security headers, prevent leaks, TLS hardening, &amp;hellip; Integrated ModSecurity WAF with the OWASP Core Rule Set Automatic ban of strange behaviors with fail2ban Antibot challenge through cookie, javascript, captcha or recaptcha v3 Block TOR, proxies, bad user-agents, countries, &amp;hellip; Block known bad IP with DNSBL and CrowdSec Prevent bruteforce attacks with rate limiting Detect bad files with ClamAV Easy to configure with environment variables or web UI Automatic configuration with container labels A must have for me was having support for Let&amp;rsquo;s Encrypt and having an easy way to configure it.</description></item><item><title>Nextcloud with podman rootless containers and user systemd services. Part V - Running Nextcloud as a pod with play kube</title><link>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-v-nextcloud-pod/</link><pubDate>Thu, 28 Jan 2021 08:30:00 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/nextcloud-podman-rootless-systemd-part-v-nextcloud-pod/</guid><description>podman play kube ðŸ”—One of the cool things about podman is that is not just a docker replacement, it can do so much more!
The feature I&amp;rsquo;m talking about is being able to run Kubernetes YAML pod definitions! How cool is that?
You can read more about this feature in the podman-play-kube man, but essentially, you just need a proper pod yaml definition and podman play kube /path/to/my/pod.yaml will run it for you.</description></item><item><title>Install cockpit in CentOS7</title><link>https://www.underkube.com/pr-preview/pr-47/install-cockpit-in-centos7-2/</link><pubDate>Wed, 04 Feb 2015 11:17:21 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/install-cockpit-in-centos7-2/</guid><description>NOTE: Slightly stolen from https://jreypo.wordpress.com/2015/01/09/how-to-install-cockpit-on-centos-7/
Download the virt7-testing repo from the cockpit github wget -O /etc/yum.repos.d/virt7-testing.repo https://github.com/baude/sig-atomic-buildscripts/raw/master/virt7-testing.repo Install cockpit yum install -y cockpit Enable cockpit (notice it&amp;rsquo;s not a service but a socket) systemct enable cockpit.socket Add cockpit service to firewalld allowed services firewall-cmd --permanent --add-service=cockpit Reload the firewall to enable the previous step firewall-cmd reload Create a custom systemd configuration file for cockpit service to workaround this issue cat &amp;gt; /etc/systemd/system/cockpit.</description></item><item><title>Using systemd as cron replacement</title><link>https://www.underkube.com/pr-preview/pr-47/using-systemd-as-cron-replacement/</link><pubDate>Mon, 18 Aug 2014 14:37:35 +0000</pubDate><guid>https://www.underkube.com/pr-preview/pr-47/using-systemd-as-cron-replacement/</guid><description>One of the features of systemd are timers. This recipie shows how to run two tasks (first and second) every minute with dependencies between both.
Create a /etc/systemd/system/mytimer.timer file with the following content [Unit] Description=run my timer tasks every minute and after reboot [Timer] OnBootSec=5min OnCalendar=*:0/1 Unit=mytimer.target [Install] WantedBy=basic.target Create a /etc/systemd/system/mytimer.target file with the following content: [Unit] Description=Mytimer StopWhenUnneeded=yes Create a first.service (it will be called before second.service) in /etc/systemd/system/first.</description></item></channel></rss>